<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محرر النصوص</title>
    <style>
        /* أنماط عامة */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            box-sizing: border-box;
            background-color: #000;
            color: #fff;
        }
        *, *::before, *::after {
            box-sizing: border-box;
        }
        .page {
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
        }
        .page.active {
            display: flex;
        }

        /* 1. صفحة القائمة الرئيسية (Home) */
        #homePage {
            background-color: #000;
            overflow-y: auto;
        }
        #articlesContainer {
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        .article-card {
            background-color: #222;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .article-card h3 {
            margin: 0 0 10px;
            font-size: 1.2rem;
            color: #eee;
        }
        .article-card p {
            margin: 0 0 15px;
            font-size: 0.9rem;
            color: #ccc;
            flex-grow: 1;
            line-height: 1.5;
        }
        .card-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .card-buttons button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-edit { background-color: #ffc107; color: #000; }
        .btn-delete { background-color: #dc3545; color: #fff; }
        .btn-view { background-color: #17a2b8; color: #fff; }

        /* زر الإضافة العائم */
        #addArticleButton {
            position: fixed;
            bottom: 25px;
            left: 25px; 
            width: 60px;
            height: 60px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 36px;
            line-height: 60px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1000;
        }
        #noArticlesMessage {
            text-align: center;
            margin-top: 50px;
            color: #888;
            font-size: 1.1rem;
            width: 100%;
        }

        /* 2. صفحة المحرر (Editor) */
        #editorPage {
            background-color: #fff;
            color: #000;
        }
        #toolbar {
            background-color: #f1f1f1;
            padding: 8px;
            border-bottom: 1px solid #ccc;
            overflow-x: auto;
            white-space: nowrap;
            display: flex;
            align-items: center;
        }
        #toolbar button, #toolbar select {
            margin: 2px;
            padding: 6px 10px;
            border: 1px solid #ccc;
            background-color: #fff;
            cursor: pointer;
            min-width: 40px;
        }
        #toolbar button:hover, #toolbar select:hover {
            background-color: #e9e9e9;
        }
        #toolbar select {
            -webkit-appearance: none;
            appearance: none;
        }
        #editor {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            outline: none;
            line-height: 1.6;
            font-size: 16px;
            border: none;
        }
        .editor-footer {
            display: flex;
            border-top: 1px solid #ccc;
        }
        .editor-footer button {
            flex: 1;
            padding: 15px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }
        #saveButton {
            background-color: #28a745;
            color: white;
        }
        #backButton {
            background-color: #6c757d;
            color: white;
        }
    </style>
</head>
<body>

    <div id="homePage" class="page active">
        <div id="articlesContainer">
            </div>
        
        <div id="noArticlesMessage" style="display: none;">
            لا توجد مقالات. انقر على الزر الأخضر لإضافة مقال جديد.
        </div>
        
        <button id="addArticleButton" title="إضافة مقال جديد">+</button>
    </div>

    <div id="editorPage" class="page">
        <div id="toolbar">
            <button data-command="formatBlock" data-value="H1">H1</button>
            <button data-command="formatBlock" data-value="H2">H2</button>
            <button data-command="formatBlock" data-value="H3">H3</button>
            <button data-command="formatBlock" data-value="P">فقرة</button>
            <button data-command="bold"><b>B</b></button>
            <button data-command="underline"><u>U</u></button>
            <button data-command="insertOrderedList">1.</button>
            <button data-command="insertUnorderedList">&bull;</button>
            <button data-command="justifyLeft">&Rarr;</button>
            <button data-command="justifyCenter">&equiv;</button>
            <button data-command="justifyRight">&Larr;</button>
            <button data-command="createLink">رابط</button>
            <button data-command="insertImage">صورة</button>
            <button data-command="formatBlock" data-value="BLOCKQUOTE">اقتباس</button>
            
            <label>لون الخط:</label>
            <input type="color" id="foreColorPicker" title="لون الخط" style="padding: 0; border: none; width: 30px; height: 30px; vertical-align: middle;">
            
            <label>لون الخلفية:</label>
            <input type="color" id="backColorPicker" title="لون خلفية النص" style="padding: 0; border: none; width: 30px; height: 30px; vertical-align: middle;">
        </div>

        <div id="editor" contenteditable="true" dir="auto">
            </div>

        <div class="editor-footer">
            <button id="backButton">رجوع</button>
            <button id="saveButton">حفظ</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const homePage = document.getElementById('homePage');
            const editorPage = document.getElementById('editorPage');
            const articlesContainer = document.getElementById('articlesContainer');
            const addArticleButton = document.getElementById('addArticleButton');
            const noArticlesMessage = document.getElementById('noArticlesMessage');
            
            const editor = document.getElementById('editor');
            const toolbar = document.getElementById('toolbar');
            const saveButton = document.getElementById('saveButton');
            const backButton = document.getElementById('backButton');
            const foreColorPicker = document.getElementById('foreColorPicker');
            const backColorPicker = document.getElementById('backColorPicker');

            let currentEditingId = null;

            // ===== وظائف مساعدة =====

            /** جلب المقالات من localStorage */
            function getArticles() {
                return JSON.parse(localStorage.getItem('articles')) || [];
            }

            /** حفظ المقالات في localStorage */
            function saveArticles(articles) {
                localStorage.setItem('articles', JSON.stringify(articles));
            }

            /** تبديل بين الصفحات */
            function showPage(pageName) {
                homePage.classList.remove('active');
                editorPage.classList.remove('active');
                
                if (pageName === 'home') {
                    homePage.classList.add('active');
                } else if (pageName === 'editor') {
                    editorPage.classList.add('active');
                }
            }

            /** استخراج العنوان (أول H1) */
            function extractTitle(html) {
                const doc = new DOMParser().parseFromString(html, 'text/html');
                const h1 = doc.querySelector('h1');
                return h1 ? h1.textContent.trim() : "مقالة بدون عنوان";
            }

            /** استخراج مقتطف (أول 100 حرف نصي) */
            function extractSnippet(html) {
                const doc = new DOMParser().parseFromString(html, 'text/html');
                const text = doc.body.textContent || "";
                return text.trim().substring(0, 100) + (text.length > 100 ? '...' : '');
            }

            // ===== منطق الصفحة الرئيسية =====

            /** تحميل وعرض بطاقات المقالات */
            function loadArticles() {
                articlesContainer.innerHTML = '';
                const articles = getArticles().sort((a, b) => b.id - a.id); // الأحدث أولاً

                if (articles.length === 0) {
                    noArticlesMessage.style.display = 'block';
                } else {
                    noArticlesMessage.style.display = 'none';
                    articles.forEach(article => {
                        const title = article.title || extractTitle(article.content);
                        const snippet = extractSnippet(article.content);
                        
                        const card = document.createElement('div');
                        card.className = 'article-card';
                        card.dataset.id = article.id;
                        
                        card.innerHTML = `
                            <h3>${title}</h3>
                            <p>${snippet}</p>
                            <div class="card-buttons">
                                <button class="btn-edit">تعديل</button>
                                <button class="btn-delete">حذف</button>
                                <button class="btn-view">عرض</button>
                            </div>
                        `;
                        articlesContainer.appendChild(card);
                    });
                }
            }

            /** إضافة مستمعي الأحداث لبطاقات المقالات (تعديل/حذف/عرض) */
            articlesContainer.addEventListener('click', (e) => {
                const target = e.target;
                const card = target.closest('.article-card');
                if (!card) return;
                
                const id = card.dataset.id;

                if (target.classList.contains('btn-edit')) {
                    editArticle(id);
                } else if (target.classList.contains('btn-delete')) {
                    deleteArticle(id);
                } else if (target.classList.contains('btn-view')) {
                    viewArticle(id);
                }
            });

            /** فتح المحرر لتعديل مقال */
            function editArticle(id) {
                const articles = getArticles();
                const article = articles.find(a => a.id == id);
                if (article) {
                    currentEditingId = id;
                    editor.innerHTML = article.content;
                    showPage('editor');
                }
            }

            /** حذف مقال */
            function deleteArticle(id) {
                if (!confirm('هل أنت متأكد من رغبتك في حذف هذا المقال؟')) {
                    return;
                }
                let articles = getArticles();
                articles = articles.filter(a => a.id != id);
                saveArticles(articles);
                loadArticles();
            }

            /** عرض المقال في متصفح خارجي */
            function viewArticle(id) {
                // يجب أن تكون الملفات على استضافة ليعمل هذا
                const url = `article.html?id=${id}`;
                window.open(url, '_system');
            }

            // ===== منطق صفحة المحرر =====

            /** زر إضافة مقال جديد */
            addArticleButton.addEventListener('click', () => {
                currentEditingId = null;
                editor.innerHTML = '<h1>اكتب العنوان هنا</h1><p>ابدأ بكتابة مقالك...</p>';
                showPage('editor');
                editor.focus();
            });

            /** زر الرجوع */
            backButton.addEventListener('click', () => {
                if (confirm('هل تريد الرجوع؟ لن يتم حفظ أي تغييرات غير محفوظة.')) {
                    currentEditingId = null;
                    editor.innerHTML = '';
                    showPage('home');
                }
            });

            /** زر الحفظ */
            saveButton.addEventListener('click', () => {
                const content = editor.innerHTML;
                const title = extractTitle(content);
                let articles = getArticles();
                
                if (currentEditingId) {
                    // تحديث مقال موجود
                    const index = articles.findIndex(a => a.id == currentEditingId);
                    if (index > -1) {
                        articles[index].content = content;
                        articles[index].title = title;
                        articles[index].updatedAt = Date.now();
                    }
                } else {
                    // إضافة مقال جديد
                    const newArticle = {
                        id: Date.now(),
                        title: title,
                        content: content,
                        createdAt: Date.now()
                    };
                    articles.push(newArticle);
                }
                
                saveArticles(articles);
                currentEditingId = null;
                showPage('home');
                loadArticles();
            });

            /** معالج شريط الأدوات */
            toolbar.addEventListener('click', (e) => {
                let target = e.target.closest('button');
                if (!target) return;

                const command = target.dataset.command;
                const value = target.dataset.value;

                if (command === 'createLink') {
                    const url = prompt('أدخل الرابط:', 'https://');
                    if (url) {
                        document.execCommand(command, false, url);
                    }
                } else if (command === 'insertImage') {
                    const url = prompt('أدخل رابط الصورة:', 'https://');
                    if (url) {
                        document.execCommand(command, false, url);
                    }
                } else {
                    document.execCommand(command, false, value || null);
                }
                editor.focus();
            });

            // معالجات ألوان
            foreColorPicker.addEventListener('input', (e) => {
                document.execCommand('foreColor', false, e.target.value);
                editor.focus();
            });
            backColorPicker.addEventListener('input', (e) => {
                document.execCommand('backColor', false, e.target.value);
                editor.focus();
            });

            // ===== التشغيل الأولي =====
            loadArticles();
            showPage('home');
        });
    </script>
</body>
</html>
